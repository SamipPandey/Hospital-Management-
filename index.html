<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HMS Enterprise | Synchronized Crystal v26.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           iOS 26 LIQUID GLASS DESIGN SYSTEM
           Three-layer glass: effect ‚Üí tint ‚Üí shine ‚Üí content
           SVG feDisplacementMap + feSpecularLighting refraction
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        :root {
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Inter", sans-serif;
            --font-mono: "JetBrains Mono", "SF Mono", monospace;

            /* iOS 26 semantic palette */
            --ios-blue:    #007aff;
            --ios-green:   #34c759;
            --ios-red:     #ff3b30;
            --ios-orange:  #ff9500;
            --ios-indigo:  #5856d6;
            --ios-teal:    #5ac8fa;

            /* Light mode surfaces */
            --bg: #f2f2f7;
            --text-1: #1c1c1e;
            --text-2: #3a3a3c;
            --text-3: #8e8e93;

            /* Liquid Glass layers */
            --lg-blur:      saturate(180%) blur(28px);
            --lg-tint:      rgba(255,255,255,0.18);
            --lg-shine-top: rgba(255,255,255,0.82);
            --lg-shine-bot: rgba(255,255,255,0.08);
            --lg-border:    rgba(255,255,255,0.55);
            --lg-shadow:    0 8px 32px rgba(0,0,0,0.08), 0 1px 0 rgba(255,255,255,0.9) inset, 0 -1px 0 rgba(0,0,0,0.04) inset;
            --lg-shadow-lg: 0 20px 60px rgba(0,0,0,0.12), 0 1px 0 rgba(255,255,255,0.9) inset;

            --r-pill:  9999px;
            --r-xl:    28px;
            --r-lg:    22px;
            --r-md:    16px;
            --sidebar: 320px;
            --ease:    cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --spring:  cubic-bezier(0.34, 1.56, 0.64, 1);
            --liquid:  cubic-bezier(0.7, 0, 0.3, 1);
        }

        body.dark {
            --bg: #000000;
            --text-1: #ffffff;
            --text-2: #ebebf5cc;
            --text-3: #8e8e93;
            --lg-tint:      rgba(28,28,30,0.55);
            --lg-shine-top: rgba(255,255,255,0.18);
            --lg-shine-bot: rgba(255,255,255,0.02);
            --lg-border:    rgba(255,255,255,0.12);
            --lg-shadow:    0 8px 40px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.12) inset;
            --lg-shadow-lg: 0 24px 80px rgba(0,0,0,0.7), 0 1px 0 rgba(255,255,255,0.1) inset;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; outline: none; }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text-1);
            height: 100vh; width: 100vw;
            display: flex; overflow: hidden;
            transition: background 0.6s var(--ease), color 0.6s;
        }

        /* ‚îÄ‚îÄ ANIMATED MESH WALLPAPER ‚îÄ‚îÄ */
        #wallpaper {
            position: fixed; inset: 0; z-index: 0;
            background:
                radial-gradient(ellipse 80% 60% at 10% 20%, rgba(0,122,255,0.18) 0%, transparent 60%),
                radial-gradient(ellipse 60% 80% at 90% 10%, rgba(88,86,214,0.14) 0%, transparent 55%),
                radial-gradient(ellipse 70% 50% at 50% 90%, rgba(52,199,89,0.10) 0%, transparent 60%),
                radial-gradient(ellipse 50% 70% at 80% 70%, rgba(255,149,0,0.10) 0%, transparent 55%),
                var(--bg);
            animation: wallShift 18s ease-in-out infinite alternate;
        }
        body.dark #wallpaper {
            background:
                radial-gradient(ellipse 80% 60% at 10% 20%, rgba(10,132,255,0.22) 0%, transparent 60%),
                radial-gradient(ellipse 60% 80% at 90% 10%, rgba(94,92,230,0.18) 0%, transparent 55%),
                radial-gradient(ellipse 70% 50% at 50% 90%, rgba(48,209,88,0.12) 0%, transparent 60%),
                radial-gradient(ellipse 50% 70% at 80% 70%, rgba(255,159,10,0.12) 0%, transparent 55%),
                #000;
        }
        @keyframes wallShift {
            0%   { filter: hue-rotate(0deg) brightness(1); }
            50%  { filter: hue-rotate(15deg) brightness(1.03); }
            100% { filter: hue-rotate(-10deg) brightness(0.97); }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           LIQUID GLASS COMPONENT ‚Äî 4 Layered Divs
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* The wrapper: just sets position + shape */
        .lg {
            position: relative;
            border-radius: var(--r-xl);
            overflow: hidden;
            isolation: isolate;
            transition: transform 0.5s var(--spring), box-shadow 0.4s var(--ease);
        }
        .lg:hover { transform: translateY(-2px); }

        /* Layer 0: distortion filter (SVG feDisplacementMap) */
        .lg-distort {
            position: absolute; inset: 0; z-index: 0;
            backdrop-filter: var(--lg-blur);
            -webkit-backdrop-filter: var(--lg-blur);
            filter: url(#lg-refract);
        }
        /* Layer 1: tinted translucent fill */
        .lg-tint {
            position: absolute; inset: 0; z-index: 1;
            background: var(--lg-tint);
            border-radius: inherit;
        }
        /* Layer 2: specular shine ‚Äî bright top-left rim */
        .lg-shine {
            position: absolute; inset: 0; z-index: 2;
            border-radius: inherit;
            box-shadow:
                inset 1.5px 1.5px 0 rgba(255,255,255,0.85),
                inset -1px -1px 0 rgba(255,255,255,0.1),
                inset 0 0 12px rgba(255,255,255,0.12);
            border: 1px solid var(--lg-border);
        }
        /* Layer 3: actual content */
        .lg-content {
            position: relative; z-index: 3;
            height: 100%;
        }

        /* Shorthand: the whole glass panel */
        .glass {
            position: relative;
            border-radius: var(--r-xl);
            overflow: hidden;
            isolation: isolate;
            box-shadow: var(--lg-shadow);
            transition: box-shadow 0.4s, transform 0.5s var(--spring);
        }
        .glass::before {
            content: '';
            position: absolute; inset: 0; z-index: 0;
            backdrop-filter: var(--lg-blur);
            -webkit-backdrop-filter: var(--lg-blur);
            border-radius: inherit;
        }
        .glass::after {
            content: '';
            position: absolute; inset: 0; z-index: 1;
            background: var(--lg-tint);
            border-radius: inherit;
        }
        /* Shine ring sits above ::after but below content */
        .glass > * { position: relative; z-index: 3; }
        .glass-shine {
            position: absolute; inset: 0; z-index: 2; pointer-events: none;
            border-radius: inherit;
            box-shadow:
                inset 1.5px 1.5px 0 rgba(255,255,255,0.8),
                inset -1px -1px 0 rgba(255,255,255,0.08),
                inset 0 0 14px rgba(255,255,255,0.08);
            border: 1px solid var(--lg-border);
        }
        .glass:hover { box-shadow: var(--lg-shadow-lg); }

        /* Pill variant */
        .glass-pill { border-radius: var(--r-pill); }

        /* ‚ïê‚ïê LOGIN ‚ïê‚ïê */
        #loginOverlay {
            position: fixed; inset: 0; z-index: 99999;
            display: flex; align-items: center; justify-content: center;
            background: url('https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?auto=format&fit=crop&q=80&w=2000') center/cover;
            transition: opacity 0.9s var(--ease);
        }
        #loginOverlay::before {
            content: ''; position: absolute; inset: 0;
            backdrop-filter: blur(60px) saturate(200%) brightness(0.85);
            -webkit-backdrop-filter: blur(60px) saturate(200%) brightness(0.85);
            background: rgba(255,255,255,0.2);
        }
        body.dark #loginOverlay::before { background: rgba(0,0,0,0.5); }

        .login-card {
            position: relative; z-index: 2;
            width: 90%; max-width: 400px;
            padding: 52px 44px;
            border-radius: 38px;
            text-align: center;
            box-shadow: 0 40px 100px rgba(0,0,0,0.2), 0 2px 0 rgba(255,255,255,0.9) inset;
        }

        /* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
        #sidebar {
            position: relative; z-index: 100;
            width: var(--sidebar);
            margin: 16px;
            display: flex; flex-direction: column;
            border-radius: var(--r-xl);
            overflow: hidden;
            isolation: isolate;
            box-shadow: var(--lg-shadow-lg);
            flex-shrink: 0;
        }
        #sidebar::before {
            content: ''; position: absolute; inset: 0; z-index: 0;
            backdrop-filter: var(--lg-blur);
            -webkit-backdrop-filter: var(--lg-blur);
        }
        #sidebar::after {
            content: ''; position: absolute; inset: 0; z-index: 1;
            background: var(--lg-tint);
        }
        .sidebar-shine {
            position: absolute; inset: 0; z-index: 2; pointer-events: none;
            border-radius: inherit;
            box-shadow:
                inset 1.5px 1.5px 0 rgba(255,255,255,0.75),
                inset -1px -1px 0 rgba(255,255,255,0.06);
            border: 1px solid var(--lg-border);
        }
        .sidebar-inner { position: relative; z-index: 3; display: flex; flex-direction: column; height: 100%; }

        .sidebar-header {
            padding: 36px 28px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.25);
        }
        body.dark .sidebar-header { border-bottom-color: rgba(255,255,255,0.07); }

        /* ‚ïê‚ïê NAV ITEMS ‚ïê‚ïê */
        .nav-list { flex: 1; padding: 16px; overflow-y: auto; position: relative; }

        /* Liquid blob ‚Äî the morphing highlight */
        #nav-blob {
            position: absolute; left: 12px;
            width: calc(100% - 24px); height: 52px;
            border-radius: 18px;
            background: var(--ios-blue);
            transition: top 0.55s var(--liquid), opacity 0.3s;
            opacity: 0; z-index: 0;
            box-shadow: 0 4px 16px rgba(0,122,255,0.35);
            /* specular on blob */
            overflow: hidden;
        }
        #nav-blob::after {
            content: '';
            position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.35) 0%, transparent 50%);
            border-radius: inherit;
        }

        .nav-item {
            position: relative; z-index: 2;
            display: flex; align-items: center; gap: 14px;
            padding: 15px 18px;
            border-radius: 18px;
            font-size: 14.5px; font-weight: 600;
            color: var(--text-2);
            cursor: pointer;
            margin-bottom: 4px;
            transition: color 0.3s;
            user-select: none;
        }
        .nav-item:hover { color: var(--text-1); }
        .nav-item.active { color: #fff !important; font-weight: 700; }

        /* ‚ïê‚ïê VIEWPORT ‚ïê‚ïê */
        #viewport {
            flex: 1; margin: 16px 16px 16px 0;
            padding: 40px;
            overflow-y: auto;
            position: relative; z-index: 10;
            display: flex; flex-direction: column; gap: 28px;
        }

        /* ‚ïê‚ïê PAGE TITLE ‚ïê‚ïê */
        .page-title { font-size: 48px; font-weight: 900; letter-spacing: -3px; line-height: 1; }
        .page-subtitle { color: var(--text-3); font-size: 17px; font-weight: 500; margin-top: 6px; }

        /* ‚ïê‚ïê CARDS ‚ïê‚ïê */
        .section-in { animation: secIn 0.5s var(--spring) forwards; }
        @keyframes secIn {
            from { opacity: 0; transform: translateY(22px) scale(0.98); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }

        .grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 20px; }
        .grid-2-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }

        .stat-card { padding: 32px; display: flex; flex-direction: column; justify-content: space-between; min-height: 160px; }
        .stat-label { font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; color: var(--text-3); }
        .stat-val { font-size: 44px; font-weight: 800; letter-spacing: -2.5px; line-height: 1; margin: 12px 0 8px; }
        .stat-note { font-size: 11px; font-weight: 700; }

        /* ‚ïê‚ïê INPUTS ‚ïê‚ïê */
        input, select, textarea {
            width: 100%;
            background: rgba(255,255,255,0.35);
            border: 1px solid rgba(255,255,255,0.5);
            padding: 16px 20px;
            border-radius: var(--r-md);
            color: var(--text-1);
            font-size: 14px; font-family: var(--font);
            margin-bottom: 14px;
            transition: all 0.3s;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        body.dark input, body.dark select, body.dark textarea {
            background: rgba(255,255,255,0.07);
            border-color: rgba(255,255,255,0.12);
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--ios-blue);
            background: rgba(255,255,255,0.7);
            box-shadow: 0 0 0 4px rgba(0,122,255,0.15);
            color: #000;
        }
        body.dark input:focus { background: rgba(0,122,255,0.12); color: #fff; }

        /* ‚ïê‚ïê BUTTONS ‚ïê‚ïê */
        .btn {
            padding: 16px 34px;
            border: none; border-radius: var(--r-pill);
            font-size: 14px; font-weight: 700;
            cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            transition: all 0.2s var(--ease);
            position: relative; overflow: hidden;
            isolation: isolate;
        }
        .btn::before {
            content: '';
            position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 55%);
            border-radius: inherit;
        }
        .btn::after {
            content: '';
            position: absolute; inset: 0;
            box-shadow: inset 1px 1px 0 rgba(255,255,255,0.5), inset -1px -1px 0 rgba(0,0,0,0.08);
            border-radius: inherit;
        }
        .btn:active { transform: scale(0.95); }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,0,0,0.15); }

        .btn-primary { background: var(--ios-blue); color: #fff; box-shadow: 0 6px 20px rgba(0,122,255,0.4); }
        .btn-danger  { background: var(--ios-red);  color: #fff; box-shadow: 0 6px 20px rgba(255,59,48,0.3); }
        .btn-glass {
            background: rgba(255,255,255,0.25);
            border: 1px solid rgba(255,255,255,0.5);
            color: var(--text-1);
            backdrop-filter: blur(12px);
        }

        /* ‚ïê‚ïê TABLES ‚ïê‚ïê */
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { text-align: left; padding: 0 18px; font-size: 9px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-3); font-weight: 900; }
        td {
            background: rgba(255,255,255,0.3);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.4);
            padding: 18px; font-weight: 600; font-size: 13.5px;
        }
        body.dark td { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.07); }
        td:first-child { border-radius: 16px 0 0 16px; border-right: none; }
        td:last-child  { border-radius: 0 16px 16px 0; border-left: none; }
        td:not(:first-child):not(:last-child) { border-left: none; border-right: none; }

        /* ‚ïê‚ïê AUDIT LOG ‚ïê‚ïê */
        .audit {
            background: rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.06);
            font-family: var(--font-mono); padding: 22px; border-radius: 20px;
            height: 280px; overflow-y: auto; font-size: 11px; line-height: 1.9;
            color: var(--text-2);
        }
        body.dark .audit { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.06); }

        /* ‚ïê‚ïê GALLERY ‚ïê‚ïê */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 24px; }
        .gallery-node {
            border-radius: 26px; overflow: hidden; height: 210px;
            border: 1.5px solid rgba(255,255,255,0.5);
            cursor: pointer; position: relative;
            transition: transform 0.7s var(--spring), box-shadow 0.4s;
        }
        .gallery-node::after {
            content: ''; position: absolute; inset: 0;
            box-shadow: inset 1px 1px 0 rgba(255,255,255,0.6);
            border-radius: inherit;
        }
        .gallery-node img { width: 100%; height: 100%; object-fit: cover; transition: transform 1s var(--ease); }
        .gallery-node:hover { transform: translateY(-12px) scale(1.03); box-shadow: 0 24px 60px rgba(0,0,0,0.15); }
        .gallery-node:hover img { transform: scale(1.12); }

        /* ‚ïê‚ïê PILLS / BADGES ‚ïê‚ïê */
        .badge {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 4px 10px; border-radius: var(--r-pill);
            font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .badge-orange { background: rgba(255,149,0,0.15); color: var(--ios-orange); border: 1px solid rgba(255,149,0,0.25); }

        /* ‚ïê‚ïê SECTOR CHIP ‚ïê‚ïê */
        #sectorChip {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 18px; border-radius: var(--r-pill);
            font-size: 12px; font-weight: 700;
            background: var(--ios-blue); color: #fff;
            box-shadow: 0 4px 14px rgba(0,122,255,0.35);
            margin-bottom: 18px;
            opacity: 0; transform: translateY(8px) scale(0.95);
            transition: opacity 0.4s, transform 0.5s var(--spring);
        }
        #sectorChip.active { opacity: 1; transform: translateY(0) scale(1); }

        /* ‚ïê‚ïê TOASTS ‚ïê‚ïê */
        #toasts { position: fixed; top: 24px; right: 24px; z-index: 999999; display: flex; flex-direction: column; gap: 12px; }
        .toast {
            padding: 16px 28px; border-radius: var(--r-pill);
            font-size: 13.5px; font-weight: 700;
            backdrop-filter: blur(30px) saturate(200%);
            -webkit-backdrop-filter: blur(30px) saturate(200%);
            background: rgba(255,255,255,0.7);
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 0 12px 40px rgba(0,0,0,0.1), inset 1px 1px 0 rgba(255,255,255,0.9);
            color: var(--text-1);
            animation: toastIn 0.5s var(--spring) forwards;
        }
        body.dark .toast { background: rgba(44,44,46,0.9); border-color: rgba(255,255,255,0.1); }
        @keyframes toastIn { from { transform: translateX(110%) scale(0.9); opacity:0; } to { transform: translateX(0) scale(1); opacity:1; } }

        /* ‚ïê‚ïê MODAL ‚ïê‚ïê */
        #modal-root {
            position: fixed; inset: 0; z-index: 500000;
            backdrop-filter: blur(24px) brightness(0.9);
            -webkit-backdrop-filter: blur(24px) brightness(0.9);
            background: rgba(0,0,0,0.25);
            display: none; align-items: center; justify-content: center;
        }
        .invoice-card {
            background: rgba(255,255,255,0.88);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            color: #000; width: 520px; padding: 56px;
            border-radius: 40px;
            box-shadow: 0 60px 120px rgba(0,0,0,0.25), inset 1.5px 1.5px 0 rgba(255,255,255,0.95);
            border: 1px solid rgba(255,255,255,0.7);
        }

        /* ‚ïê‚ïê DARK TOGGLE ‚ïê‚ïê */
        .toggle-wrap {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px;
            border-radius: 16px;
            background: rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.06);
            margin-top: 20px;
        }
        body.dark .toggle-wrap { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.08); }
        .toggle-track {
            width: 52px; height: 30px;
            border-radius: var(--r-pill);
            background: rgba(120,120,128,0.2);
            position: relative; cursor: pointer;
            transition: background 0.3s;
            border: 1px solid rgba(0,0,0,0.08);
        }
        body.dark .toggle-track { background: var(--ios-green); }
        .toggle-knob {
            width: 26px; height: 26px;
            background: #fff; border-radius: 50%;
            position: absolute; top: 1px; left: 1px;
            transition: transform 0.3s var(--spring);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        body.dark .toggle-knob { transform: translateX(22px); }

        /* ‚ïê‚ïê FINANCE ‚ïê‚ïê */
        .fin-hero { text-align: center; padding: 80px 60px; }
        .fin-num { font-size: 100px; font-weight: 900; color: var(--ios-green); letter-spacing: -6px; line-height: 1; margin: 30px 0 50px; }

        /* ‚ïê‚ïê PRESCRIPTION BADGE ‚ïê‚ïê */
        .rx-badge { background: rgba(255,149,0,0.12); color: var(--ios-orange); border: 1px solid rgba(255,149,0,0.2); padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; }

        /* ‚ïê‚ïê UTILS ‚ïê‚ïê */
        .hidden { display: none !important; }
        .v-stack { display: flex; flex-direction: column; }
        .h-stack { display: flex; align-items: center; }
        .gap-12 { gap: 12px; }
        .p-40 { padding: 40px; }
        .p-48 { padding: 48px; }
        .mb-24 { margin-bottom: 24px; }
        .mb-32 { margin-bottom: 32px; }
        .mt-24 { margin-top: 24px; }

        /* ‚ïê‚ïê SCROLLBAR ‚ïê‚ïê */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 99px; }
        body.dark ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); }

        /* ‚ïê‚ïê MOBILE ‚ïê‚ïê */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #sidebar {
                width: 100%; margin: 0; height: 80px;
                border-radius: 0; flex-direction: row;
                position: fixed; bottom: 0; left: 0; z-index: 2000;
            }
            .sidebar-header, #nav-blob, .sidebar-logout, #sys-role { display: none !important; }
            .nav-list { display: flex; flex-direction: row; justify-content: space-around; align-items: center; padding: 0; }
            .nav-item { flex-direction: column; margin: 0; padding: 8px; gap: 3px; font-size: 9px; }
            #viewport { margin: 0; padding: 20px 20px 100px; }
            .grid-3, .grid-2-1 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     iOS 26 LIQUID GLASS SVG FILTERS
     feDisplacementMap = edge refraction
     feSpecularLighting = specular rim
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<svg width="0" height="0" style="position:absolute;overflow:hidden;">
  <defs>

    <!-- Primary glass refraction filter -->
    <filter id="lg-refract" x="-5%" y="-5%" width="110%" height="110%" color-interpolation-filters="sRGB">
      <feTurbulence type="fractalNoise" baseFrequency="0.008 0.008" numOctaves="2" seed="3" result="turb"/>
      <feComponentTransfer in="turb" result="mapped">
        <feFuncR type="gamma" amplitude="1" exponent="8" offset="0.5"/>
        <feFuncG type="gamma" amplitude="0" exponent="1" offset="0"/>
        <feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5"/>
      </feComponentTransfer>
      <feGaussianBlur in="mapped" stdDeviation="2.5" result="softMap"/>
      <!-- Edge displacement ‚Äî refracts background at borders -->
      <feDisplacementMap in="SourceGraphic" in2="softMap" scale="22" xChannelSelector="R" yChannelSelector="B" result="displaced"/>
      <!-- Specular lighting layer -->
      <feSpecularLighting in="softMap" surfaceScale="4" specularConstant="0.8" specularExponent="80" lighting-color="white" result="spec">
        <fePointLight x="-100" y="-150" z="250"/>
      </feSpecularLighting>
      <feComposite in="spec" in2="SourceAlpha" operator="in" result="specMasked"/>
      <feBlend in="displaced" in2="specMasked" mode="screen"/>
    </filter>

    <!-- Nav blob metaball morphing -->
    <filter id="metaball">
      <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur"/>
      <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 22 -10"/>
    </filter>

    <!-- Stronger refraction for sidebar/header elements -->
    <filter id="lg-strong" x="-5%" y="-5%" width="110%" height="110%">
      <feTurbulence type="fractalNoise" baseFrequency="0.006 0.006" numOctaves="2" seed="7" result="t"/>
      <feGaussianBlur in="t" stdDeviation="3" result="sm"/>
      <feDisplacementMap in="SourceGraphic" in2="sm" scale="35" xChannelSelector="R" yChannelSelector="G"/>
    </filter>

  </defs>
</svg>

<div id="wallpaper"></div>
<div id="toasts"></div>

<!-- ‚ïê‚ïê MODAL ‚ïê‚ïê -->
<div id="modal-root">
    <div class="invoice-card v-stack">
        <div class="glass-shine" style="position:absolute;inset:0;pointer-events:none;border-radius:40px;z-index:10;"></div>
        <h2 style="font-size:30px;font-weight:900;letter-spacing:-1.5px;border-bottom:1px solid rgba(0,0,0,0.08);padding-bottom:22px;margin:0;">FISCAL RECEIPT</h2>
        <div id="invoice-payload" style="padding:36px 0;font-family:var(--font-mono);line-height:2.2;font-size:13px;white-space:pre-wrap;flex:1;"></div>
        <div class="h-stack gap-12">
            <button class="btn btn-primary" style="flex:1;" onclick="window.print()">PRINT NODE</button>
            <button class="btn btn-glass" style="flex:1;" onclick="closeModal()">DISMISS</button>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê LOGIN ‚ïê‚ïê -->
<div id="loginOverlay">
    <div class="glass login-card v-stack">
        <div class="glass-shine"></div>
        <div style="font-size:64px;margin-bottom:20px;filter:drop-shadow(0 4px 12px rgba(0,0,0,0.15));">üè•</div>
        <h2 style="font-size:30px;font-weight:800;letter-spacing:-1px;">HMS Enterprise</h2>
        <p style="color:rgba(60,60,67,0.6);margin-bottom:36px;font-size:11px;font-weight:800;letter-spacing:3px;margin-top:4px;">SECURE ACCESS V26.0.3</p>
        <input type="text" id="lU" placeholder="IDENTITY UID">
        <input type="password" id="lP" placeholder="SECURITY KEY">
        <button class="btn btn-primary" style="width:100%;margin-top:4px;" onclick="runAuth()">INITIALIZE NEURAL LINK</button>
        <p id="auth-msg" style="color:var(--ios-red);margin-top:18px;font-weight:800;font-size:12px;"></p>
    </div>
</div>

<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<nav id="sidebar" class="hidden">
    <div class="sidebar-shine"></div>
    <div class="sidebar-inner">

        <div class="sidebar-header">
            <h1 id="sys-user" style="font-size:20px;font-weight:800;letter-spacing:-0.5px;">USER_NULL</h1>
            <p id="sys-role" style="font-size:9px;letter-spacing:3px;color:var(--ios-blue);font-weight:900;margin-top:3px;">NODE_LINK_ACTIVE</p>
            <div class="toggle-wrap">
                <span style="font-size:11px;font-weight:800;color:var(--text-3);">DARK MODE</span>
                <div class="toggle-track" onclick="toggleTheme()"><div class="toggle-knob"></div></div>
            </div>
        </div>

        <div class="nav-list">
            <div id="nav-blob"></div>
            <div class="nav-item active ni-admin"   id="ni-0" onclick="morphTo('dashSec',   this)">üìä <span>Dashboard Matrix</span></div>
            <div class="nav-item ni-admin"           id="ni-1" onclick="morphTo('hrSec',     this)">üë®‚Äç‚öïÔ∏è <span>Human Resources</span></div>
            <div class="nav-item ni-admin ni-doctor" id="ni-2" onclick="morphTo('admitSec',  this)">üõå <span>Clinical Intake</span></div>
            <div class="nav-item ni-admin ni-pharm"  id="ni-3" onclick="morphTo('pharmaSec', this)">üíä <span>Inventory</span></div>
            <div class="nav-item ni-admin ni-doctor" id="ni-4" onclick="morphTo('labSec',    this)">üî¨ <span>Laboratory</span></div>
            <div class="nav-item ni-admin"           id="ni-5" onclick="morphTo('financeSec',this)">üí∞ <span>Revenue & GST</span></div>
            <div class="nav-item ni-all"             id="ni-6" onclick="morphTo('searchSec', this)">üîç <span>My Medical Bill</span></div>
            <div class="nav-item ni-all"             id="ni-7" onclick="morphTo('featSec',   this)">‚ú® <span>Specifications</span></div>
            <div class="nav-item ni-all"             id="ni-8" onclick="morphTo('galSec',    this)">üñºÔ∏è <span>Facility Gallery</span></div>
            <div class="nav-item ni-clinical"        id="ni-9" onclick="morphTo('gameSec',   this)">üéÆ <span>Staff Break Room</span></div>
        </div>

        <div class="sidebar-logout" style="padding:20px;">
            <button class="btn btn-danger" style="width:100%;" onclick="location.reload()">üö™ VOID SESSION</button>
        </div>

    </div>
</nav>

<!-- ‚ïê‚ïê VIEWPORT ‚ïê‚ïê -->
<main id="viewport" class="hidden">

    <!-- DASHBOARD -->
    <section id="dashSec" class="hidden section-in">
        <div class="mb-32">
            <div class="page-title">Admin Telemetry</div>
            <div class="page-subtitle">System Resource Flow Sync</div>
        </div>
        <div class="grid-3">
            <div class="glass stat-card">
                <div class="glass-shine"></div>
                <span class="stat-label">Bio-Nodes Admitted</span>
                <div class="stat-val" id="dash-p-count">0</div>
                <span class="stat-note" style="color:var(--ios-green);">‚Üë 18.4% FLUX GAIN</span>
            </div>
            <div class="glass stat-card">
                <div class="glass-shine"></div>
                <span class="stat-label">Neural Integrity</span>
                <div class="stat-val">99.9%</div>
                <span class="stat-note" style="color:var(--ios-blue);">SECURE_ALPHA_UPLINK</span>
            </div>
            <div class="glass stat-card">
                <div class="glass-shine"></div>
                <span class="stat-label">Liquid Yield</span>
                <div class="stat-val" id="dash-rev">Rs 0</div>
                <span class="stat-note" style="color:var(--ios-orange);">NET_POST_TAX_REVENUE</span>
            </div>
        </div>
        <div class="grid-2-1 mt-24">
            <div class="glass p-40">
                <div class="glass-shine"></div>
                <h3 style="margin-bottom:28px;font-size:18px;font-weight:800;letter-spacing:-0.5px;">Revenue Entropy Matrix</h3>
                <canvas id="mainChart" height="130"></canvas>
            </div>
            <div class="glass p-40 v-stack">
                <div class="glass-shine"></div>
                <h3 style="margin-bottom:18px;font-size:18px;font-weight:800;">Security Audit</h3>
                <div id="auditContainer" class="audit" style="flex:1;"></div>
            </div>
        </div>
    </section>

    <!-- HR -->
    <section id="hrSec" class="hidden section-in">
        <div class="glass p-48">
            <div class="glass-shine"></div>
            <div class="page-title mb-32">Personnel Registry üë®‚Äç‚öïÔ∏è</div>
            <div class="grid-3">
                <input type="text" id="stName" placeholder="Full Professional Name">
                <select id="stRole">
                    <option value="Specialist">Senior Specialist</option>
                    <option value="Surgeon">Senior Surgeon</option>
                    <option value="Lead Nurse">Lead Nurse</option>
                    <option value="Pharmacist">Lead Pharmacist</option>
                </select>
                <input type="text" id="stSpec" placeholder="Area of Expertise (e.g. Neurology)">
            </div>
            <div class="grid-3">
                <input type="number" id="stSalary" placeholder="Monthly Base (Rs)">
                <input type="number" id="stFee" placeholder="Consultation Fee (Rs)">
                <select id="stShift">
                    <option>Morning Rotation</option>
                    <option>Night Rotation</option>
                    <option>24/7 On-Call</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="onboardStaff()">COMMIT RECORD TO CORE</button>
        </div>
        <div class="glass mt-24 p-40">
            <div class="glass-shine"></div>
            <h3 style="margin-bottom:18px;font-size:18px;font-weight:800;">Active Professional Roster</h3>
            <div id="staffListMount" style="overflow-x:auto;"></div>
        </div>
    </section>

    <!-- ADMISSIONS -->
    <section id="admitSec" class="hidden section-in">
        <div class="glass p-48">
            <div class="glass-shine"></div>
            <div class="page-title mb-32">Bio-Intake Engine üõå</div>
            <div id="sectorChip">‚ú® AI Recommendation: <span id="recText">Analyze Symptoms</span></div>
            <div class="grid-3">
                <input type="text" id="pName" placeholder="Legal Identity Name">
                <input type="number" id="pAge" placeholder="Age">
                <select id="pBlood">
                    <option>Blood Group...</option>
                    <option>A+</option><option>B+</option><option>O+</option><option>AB+</option>
                    <option>A-</option><option>B-</option><option>O-</option><option>AB-</option>
                </select>
            </div>
            <div class="grid-3">
                <select id="pDocAssign"></select>
                <input type="text" id="pEmerg" placeholder="Emergency Contact Node">
                <select id="pType" onchange="updateIntakeFields()">
                    <option value="in">In-Patient Admission</option>
                    <option value="checkup">General Checkup (OPD)</option>
                    <option value="emergency">üö® Emergency Trauma</option>
                </select>
            </div>
            <div class="grid-3">
                <select id="pRoom">
                    <option value="4000">General Ward Node (4k/d)</option>
                    <option value="15000">Infinity Glass Suite (15k/d)</option>
                    <option value="65000">Bio-Isolation Unit (65k/d)</option>
                </select>
                <input type="number" id="pDeposit" placeholder="Initial Advance (Rs)">
                <input type="text" id="pDiagnosis" placeholder="Clinical Diagnosis Matrix">
            </div>
            <textarea id="pSymptoms" style="height:110px;" placeholder="SYMPTOMS MATRIX (AI will suggest sector based on input...)" onkeyup="analyzeSymptoms()"></textarea>
            <button class="btn btn-primary" onclick="admitPatient()">AUTHORIZE ADMISSION</button>
        </div>

        <div class="glass ni-doctor mt-24 p-48">
            <div class="glass-shine"></div>
            <h2 style="font-size:22px;font-weight:800;margin-bottom:24px;">Digital Prescription Console ü©∫</h2>
            <div class="grid-3">
                <select id="prescPatSel"></select>
                <input type="text" id="prescMedName" placeholder="Medicine Name (e.g. Paracetamol)">
                <button class="btn btn-primary" onclick="addPrescription()">PRESCRIBE COMPOUND</button>
            </div>
        </div>

        <div class="glass mt-24 p-40">
            <div class="glass-shine"></div>
            <h3 style="margin-bottom:18px;font-size:18px;font-weight:800;">Active Clinical Bio-Nodes</h3>
            <div id="pListMount" style="overflow-x:auto;"></div>
        </div>
    </section>

    <!-- PHARMACY -->
    <section id="pharmaSec" class="hidden section-in">
        <div class="grid-3">
            <div class="glass p-40 v-stack">
                <div class="glass-shine"></div>
                <h3 style="margin-bottom:18px;font-size:18px;font-weight:800;">Pending Dispensing üíä</h3>
                <span class="stat-label" style="margin-bottom:8px;">Target Bio-Node</span>
                <select id="pharmaPSelect" onchange="showPrescribed()"></select>
                <div id="prescView" style="margin-bottom:16px;padding:14px;background:rgba(255,149,0,0.08);border:1px solid rgba(255,149,0,0.15);border-radius:14px;display:none;">
                    <span class="stat-label">Doctor Prescribed:</span>
                    <h3 id="prescVal" style="color:var(--ios-orange);margin-top:5px;font-size:16px;">None</h3>
                </div>
                <span class="stat-label" style="margin-bottom:8px;">Dispense Price</span>
                <input type="number" id="pharmaMedCost" placeholder="Final Compound Price (Rs)">
                <button class="btn btn-primary" style="width:100%;margin-top:auto;" onclick="dispenseMed()">DISPENSE & BILL</button>
            </div>
            <div class="glass p-40" style="grid-column:span 2;">
                <div class="glass-shine"></div>
                <h3 style="margin-bottom:24px;font-size:18px;font-weight:800;">Pharmacy Ledger Sync</h3>
                <div id="pharmaLogMount" class="audit" style="height:380px;"></div>
            </div>
        </div>
    </section>

    <!-- LAB -->
    <section id="labSec" class="hidden section-in">
        <div class="grid-3">
            <div class="glass p-40 v-stack">
                <div class="glass-shine"></div>
                <h3 style="margin-bottom:28px;font-size:18px;font-weight:800;">Diagnostic Scan üî¨</h3>
                <span class="stat-label" style="margin-bottom:8px;">Bio-Identifier</span>
                <select id="labPSelect"></select>
                <span class="stat-label" style="margin-bottom:8px;">Process Suite</span>
                <select id="labTestSelect">
                    <option value="2800">Hematology Core (2.8k)</option>
                    <option value="24000">Neural MRI Suite (24k)</option>
                    <option value="85000">Full Genomic Sequencing (85k)</option>
                </select>
                <button class="btn btn-primary" style="width:100%;margin-top:auto;" onclick="issueLab()">EXECUTE SUITE</button>
            </div>
            <div class="glass p-40" style="grid-column:span 2;">
                <div class="glass-shine"></div>
                <h3 style="margin-bottom:24px;font-size:18px;font-weight:800;">Laboratory Workflow Queue</h3>
                <div id="labLogMount" class="audit" style="height:360px;"></div>
            </div>
        </div>
    </section>

    <!-- FINANCE -->
    <section id="financeSec" class="hidden section-in">
        <div class="glass fin-hero v-stack h-stack">
            <div class="glass-shine"></div>
            <span class="stat-label">GLOBAL_NET_LIQUIDITY_LEDGER_MASTER</span>
            <div class="fin-num" id="fin-net">Rs 0</div>
            <div class="grid-3" style="width:100%;">
                <div class="glass p-40" style="background:rgba(52,199,89,0.06);">
                    <div class="glass-shine"></div>
                    <small class="stat-label">Gross Revenue</small>
                    <h3 id="fin-gross" style="margin-top:12px;font-size:28px;font-weight:800;">Rs 0</h3>
                </div>
                <div class="glass p-40" style="background:rgba(255,59,48,0.06);">
                    <div class="glass-shine"></div>
                    <small class="stat-label">Payout Nodes</small>
                    <h3 id="fin-pay" style="margin-top:12px;font-size:28px;font-weight:800;">Rs 0</h3>
                </div>
                <div class="glass p-40" style="background:rgba(0,122,255,0.06);">
                    <div class="glass-shine"></div>
                    <small class="stat-label">GST Liability (18%)</small>
                    <h3 id="fin-tax" style="margin-top:12px;font-size:28px;font-weight:800;">Rs 0</h3>
                </div>
            </div>
            <button class="btn btn-danger" style="margin-top:60px;padding:24px 80px;" onclick="wipeFiscal()">WIPE GLOBAL FISCAL LEDGER</button>
        </div>
    </section>

    <!-- SEARCH -->
    <section id="searchSec" class="hidden section-in">
        <div class="glass p-48" style="text-align:center;">
            <div class="glass-shine"></div>
            <input type="text" id="searchBar" style="font-size:28px;text-align:center;border-radius:20px;padding:36px;" placeholder="SCAN IDENTITY NODE TO FETCH BILL..." onkeyup="runSearch()">
        </div>
        <div id="searchMount" class="mt-24"></div>
    </section>

    <!-- SPECS -->
    <section id="featSec" class="hidden section-in">
        <div class="glass p-48">
            <div class="glass-shine"></div>
            <div class="page-title mb-32">Specifications ‚ú®</div>
            <p style="color:var(--text-2);font-size:17px;line-height:1.8;max-width:680px;">HMS Enterprise v26.0 ‚Äî Built on iOS 26 Liquid Glass Design System. Multi-role access control, real-time fiscal ledger, AI symptom analysis, and full clinical workflow integration. Featuring SVG feDisplacementMap refraction, specular highlights, and physics-based fluid animations.</p>
        </div>
    </section>

    <!-- GALLERY -->
    <section id="galSec" class="hidden section-in">
        <div class="glass p-48">
            <div class="glass-shine"></div>
            <div class="page-title mb-32">Facility Matrix üñºÔ∏è</div>
            <div class="gallery-grid" id="galleryMount"></div>
        </div>
    </section>

    <!-- BREAK ROOM -->
    <section id="gameSec" class="hidden section-in">
        <div class="glass p-48 v-stack h-stack" style="text-align:center;align-items:center;">
            <div class="glass-shine"></div>
            <h2 style="font-size:32px;font-weight:800;letter-spacing:-1px;margin-bottom:32px;">Staff Reflex Trainer üéÆ</h2>
            <canvas id="snakeGame" width="500" height="500" style="background:rgba(0,0,0,0.04);border-radius:36px;border:2px solid rgba(255,255,255,0.4);box-shadow:inset 1px 1px 0 rgba(255,255,255,0.6),0 12px 40px rgba(0,0,0,0.08);"></canvas>
            <h3 style="color:var(--ios-blue);margin-top:36px;font-size:40px;font-weight:900;letter-spacing:-2px;">REFLEX: <span id="snakeScore">0</span></h3>
        </div>
    </section>

</main>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HMS CORE STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SYS_CREDENTIALS = [
    { u: "admin", p: "admin", role: "admin",  name: "Administrator"    },
    { u: "doc",   p: "123",   role: "doctor", name: "Dr. Samip"        },
    { u: "pharm", p: "123",   role: "pharm",  name: "Lead Pharmacist"  },
    { u: "user",  p: "0",     role: "user",   name: "Guest Portal"     }
];

let S = {
    ROSTER:   JSON.parse(localStorage.getItem('hms_v34_roster'))   || [],
    PATIENTS: JSON.parse(localStorage.getItem('hms_v34_patients')) || [],
    AUDIT:    JSON.parse(localStorage.getItem('hms_v34_audit'))    || [],
    FISCAL: {
        rev: parseFloat(localStorage.getItem('hms_v34_rev')) || 0,
        pay: parseFloat(localStorage.getItem('hms_v34_pay')) || 0
    },
    USER: null
};

const IMAGES = [
    { url:"https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d", l:"FACILITY_MAIN" },
    { url:"https://images.unsplash.com/photo-1516549655169-df83a0774514", l:"CRYSTAL_WARD"  },
    { url:"https://images.unsplash.com/photo-1586773860418-d37222d8fce2", l:"NEURAL_LAB"    },
    { url:"https://images.unsplash.com/photo-1512678080530-7760d81faba6", l:"ATRIUM_NORTH"  },
    { url:"https://images.unsplash.com/photo-1551076805-e1869033e561", l:"ICU_SYNC"         },
    { url:"https://images.unsplash.com/photo-1579684385127-1ef15d508118", l:"PHARMA_CORE"   },
    { url:"https://images.unsplash.com/photo-1581594632702-f235ae89b022", l:"DNA_MATRIX"    },
    { url:"https://images.unsplash.com/photo-1505751172107-57324a0834d8", l:"SCALING_TECH"  },
    { url:"https://images.unsplash.com/photo-1538108197017-c1c9868bb2e3", l:"SURGERY_UNIT"  },
    { url:"https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b", l:"RECOVERY_1"    },
    { url:"https://images.unsplash.com/photo-1527613426441-4da17471b66d", l:"AMBULANCE"     },
    { url:"https://images.unsplash.com/photo-1504813184591-01572f98c85f", l:"TECH_ROOM"     }
];

/* Mouse-driven light refraction on glass panels */
document.addEventListener('mousemove', e => {
    document.querySelectorAll('.glass').forEach(el => {
        const r = el.getBoundingClientRect();
        el.style.setProperty('--mx', `${((e.clientX - r.left) / r.width)  * 100}%`);
        el.style.setProperty('--my', `${((e.clientY - r.top)  / r.height) * 100}%`);
    });
});

/* ‚ïê‚ïê AUTH ‚ïê‚ïê */
function runAuth() {
    const u = document.getElementById('lU').value.trim().toLowerCase();
    const p = document.getElementById('lP').value.trim();
    const m = SYS_CREDENTIALS.find(x => x.u === u && x.p === p);
    if (m) {
        S.USER = m;
        const lo = document.getElementById('loginOverlay');
        lo.style.opacity = '0'; lo.style.pointerEvents = 'none';
        setTimeout(() => lo.classList.add('hidden'), 900);
        document.getElementById('sidebar').classList.remove('hidden');
        document.getElementById('viewport').classList.remove('hidden');
        document.getElementById('sys-user').innerText = m.name;
        applyPermissions(m.role);
        toast('Neural link established.');
        audit('SEC: Auth OK for ' + m.u);
        if      (m.role === 'admin')  morphTo('dashSec',   document.getElementById('ni-0'));
        else if (m.role === 'doctor') morphTo('admitSec',  document.getElementById('ni-2'));
        else if (m.role === 'pharm')  morphTo('pharmaSec', document.getElementById('ni-3'));
        else                          morphTo('searchSec', document.getElementById('ni-6'));
    } else {
        document.getElementById('auth-msg').innerText = 'FATAL: BIOMETRIC MISMATCH.';
        document.getElementById('auth-msg').style.animation = 'none';
        setTimeout(() => document.getElementById('auth-msg').style.animation = '', 10);
    }
}

document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !document.getElementById('loginOverlay').classList.contains('hidden')) runAuth();
});

function applyPermissions(role) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.add('hidden'));
    document.querySelectorAll('.ni-all').forEach(n => n.classList.remove('hidden'));
    if (role === 'admin')  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('hidden'));
    else if (role === 'doctor') document.querySelectorAll('.ni-doctor,.ni-clinical').forEach(n => n.classList.remove('hidden'));
    else if (role === 'pharm')  document.querySelectorAll('.ni-pharm,.ni-clinical').forEach(n => n.classList.remove('hidden'));
}

/* ‚ïê‚ïê NAV MORPHING ‚ïê‚ïê */
function morphTo(id, navEl) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if (navEl) navEl.classList.add('active');

    const blob = document.getElementById('nav-blob');
    blob.style.opacity = '1';
    blob.style.top = navEl ? navEl.offsetTop + 'px' : '0';

    document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
    const tgt = document.getElementById(id);
    if (tgt) { tgt.classList.remove('hidden'); tgt.classList.remove('section-in'); void tgt.offsetWidth; tgt.classList.add('section-in'); }

    if (id === 'dashSec')   updateDashboard();
    if (id === 'hrSec')     renderRoster();
    if (id === 'admitSec')  renderPatients();
    if (id === 'financeSec') updateFinance();
    if (id === 'galSec')    renderGallery();
    if (id === 'gameSec')   initSnake();
    refreshSelects();
}

/* ‚ïê‚ïê THEME ‚ïê‚ïê */
function toggleTheme() {
    document.body.classList.toggle('dark');
    localStorage.setItem('hms_v34_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    toast('Theme synchronized.');
    if (S.USER && S.USER.role === 'admin') initChart();
}

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
function toast(msg) {
    const wrap = document.getElementById('toasts');
    const el = document.createElement('div');
    el.className = 'toast';
    el.innerText = '‚ö° ' + msg;
    wrap.appendChild(el);
    setTimeout(() => { el.style.opacity='0'; el.style.transform='translateX(110%)'; el.style.transition='all 0.4s'; setTimeout(()=>el.remove(),400); }, 3500);
}

/* ‚ïê‚ïê AI SYMPTOM ANALYZER ‚ïê‚ïê */
function analyzeSymptoms() {
    const s = document.getElementById('pSymptoms').value.toLowerCase();
    const chip = document.getElementById('sectorChip');
    const rules = [
        { keys: ['chest','heart','breath'], sector: 'Cardiology Unit'   },
        { keys: ['head','brain','seizure'], sector: 'Neurology Matrix'  },
        { keys: ['bone','fracture','joint'],sector: 'Orthopedic Suite'  },
        { keys: ['fever','cough','cold'],   sector: 'General Medicine'  },
        { keys: ['blood','accident','cut'], sector: 'Trauma/Emergency'  }
    ];
    const hit = rules.find(r => r.keys.some(k => s.includes(k)));
    if (s.length > 3 && hit) { document.getElementById('recText').innerText = hit.sector; chip.classList.add('active'); }
    else chip.classList.remove('active');
}

function updateIntakeFields() {
    const type = document.getElementById('pType').value;
    const room = document.getElementById('pRoom');
    room.disabled = type === 'checkup';
    room.style.opacity = type === 'checkup' ? '0.35' : '1';
    if (type === 'checkup') room.value = '0';
}

/* ‚ïê‚ïê HR ‚ïê‚ïê */
function onboardStaff() {
    const n  = document.getElementById('stName').value;
    const sl = document.getElementById('stSalary').value;
    if (!n || !sl) return toast('Registry nodes incomplete.');
    S.ROSTER.push({ id: Date.now(), n, r: document.getElementById('stRole').value, s: parseFloat(sl), f: parseFloat(document.getElementById('stFee').value)||0, sp: document.getElementById('stSpec').value||'General', sh: document.getElementById('stShift').value, earnings: 0 });
    save(); renderRoster(); toast('Professional node synchronized.'); audit('HR: '+n);
    ['stName','stSalary','stFee','stSpec'].forEach(i => document.getElementById(i).value='');
}

function renderRoster() {
    const m = document.getElementById('staffListMount');
    let h = `<table><tr><th>Professional Identity</th><th>Role / Specialty</th><th>Earnings</th><th>Action</th></tr>`;
    S.ROSTER.forEach(r => {
        h += `<tr><td><strong>${r.n}</strong><br><small style="color:var(--text-3)">Shift: ${r.sh}</small></td><td>${r.r}<br><small style="color:var(--text-3)">${r.sp}</small></td><td style="color:var(--ios-green)">Rs ${r.earnings.toLocaleString()}</td><td><button onclick="voidStaff(${r.id})" class="btn btn-danger" style="padding:8px 16px;font-size:11px;">VOID</button></td></tr>`;
    });
    m.innerHTML = h + '</table>'; refreshDocSelect();
}

function voidStaff(id) { S.ROSTER = S.ROSTER.filter(x=>x.id!==id); save(); renderRoster(); }

function refreshDocSelect() {
    const sel = document.getElementById('pDocAssign'); if(!sel) return;
    sel.innerHTML = '<option value="">Target Physician...</option>';
    S.ROSTER.filter(r=>r.r.includes('Specialist')||r.r.includes('Surgeon')).forEach(d => sel.innerHTML += `<option value="${d.n}">${d.n} (${d.sp})</option>`);
}

/* ‚ïê‚ïê ADMISSIONS ‚ïê‚ïê */
function admitPatient() {
    const n = document.getElementById('pName').value; const doc = document.getElementById('pDocAssign').value;
    if (!n||!doc) return toast('Bio-profile failure.');
    const docObj = S.ROSTER.find(x=>x.n===doc);
    S.PATIENTS.push({ id:Date.now(), name:n, age:document.getElementById('pAge').value, doc, roomPrice:parseInt(document.getElementById('pRoom').value), diagnosis:document.getElementById('pDiagnosis').value, blood:document.getElementById('pBlood').value, type:document.getElementById('pType').value, deposit:parseFloat(document.getElementById('pDeposit').value)||0, intakeDate:new Date(), status:'active', labCost:0, phaCost:0, f:docObj?docObj.f:0, prescription:'' });
    save(); renderPatients(); toast('Bio-node intake successful.'); audit('CLINIC: '+n);
    ['pName','pAge','pDiagnosis','pDeposit','pSymptoms'].forEach(i=>document.getElementById(i).value='');
    document.getElementById('sectorChip').classList.remove('active'); refreshSelects();
}

function renderPatients() {
    const m = document.getElementById('pListMount');
    let active = S.PATIENTS.filter(p=>p.status==='active');
    let h = `<table><tr><th>Bio-Node Identity</th><th>Type / Blood</th><th>Pending Doc Sync</th><th>Flux Outstanding</th></tr>`;
    active.forEach(p => {
        let b = calcBill(p);
        h += `<tr><td><strong>${p.name}</strong><br><small style="color:var(--text-3)">Lead: ${p.doc}</small></td><td>${p.type.toUpperCase()}<br><small style="color:var(--text-3)">Group: ${p.blood}</small></td><td>${p.prescription?'<span class="rx-badge">PRESCRIPTION_PENDING</span>':'<small style="color:var(--ios-green)">Cleared</small>'}</td><td style="color:var(--ios-blue);font-weight:800;">Rs ${b.total.toLocaleString()}</td></tr>`;
    });
    m.innerHTML = h + '</table>';
}

/* ‚ïê‚ïê PRESCRIPTIONS ‚ïê‚ïê */
function addPrescription() {
    const pid = document.getElementById('prescPatSel').value; const med = document.getElementById('prescMedName').value.trim();
    if (!pid||!med) return toast('Error: Target Identity Undefined.');
    const idx = S.PATIENTS.findIndex(p=>p.id==pid);
    S.PATIENTS[idx].prescription = med; save(); toast('Prescription committed.'); audit('Rx: '+med+' ‚Üí '+S.PATIENTS[idx].name);
    document.getElementById('prescMedName').value=''; renderPatients();
}

/* ‚ïê‚ïê PHARMACY ‚ïê‚ïê */
function showPrescribed() {
    const pid = document.getElementById('pharmaPSelect').value;
    const view = document.getElementById('prescView'); const text = document.getElementById('prescVal');
    if (!pid) return view.style.display='none';
    const p = S.PATIENTS.find(x=>x.id==pid);
    text.innerText = (p&&p.prescription) ? p.prescription : 'No Pending Prescriptions';
    view.style.display = 'block';
}

function dispenseMed() {
    const pid = document.getElementById('pharmaPSelect').value; const cost = parseInt(document.getElementById('pharmaMedCost').value);
    if (!pid||isNaN(cost)) return toast('Error: Price Null or Identity Null.');
    const idx = S.PATIENTS.findIndex(p=>p.id==pid);
    S.PATIENTS[idx].phaCost += cost;
    const med = S.PATIENTS[idx].prescription||'Compound Class-X'; S.PATIENTS[idx].prescription='';
    save(); document.getElementById('pharmaLogMount').innerHTML += `> [${new Date().toLocaleTimeString()}] DISPENSED [${med}] ‚Üí [${S.PATIENTS[idx].name}] Rs ${cost}<br>`; toast('Dispensed & Billed.'); showPrescribed(); document.getElementById('pharmaMedCost').value='';
}

/* ‚ïê‚ïê LAB ‚ïê‚ïê */
function refreshSelects() {
    const active = S.PATIENTS.filter(x=>x.status==='active');
    ['pharmaPSelect','labPSelect','prescPatSel'].forEach(id => {
        const s = document.getElementById(id); if(!s) return;
        s.innerHTML = '<option value="">Select identity...</option>';
        active.forEach(p=>s.innerHTML+=`<option value="${p.id}">${p.name}</option>`);
    });
}

function issueLab() {
    const pid = document.getElementById('labPSelect').value; const cost = parseInt(document.getElementById('labTestSelect').value);
    if (!pid) return; const idx = S.PATIENTS.findIndex(p=>p.id==pid);
    S.PATIENTS[idx].labCost += cost; save();
    document.getElementById('labLogMount').innerHTML += `> [${new Date().toLocaleTimeString()}] SCAN DONE [${S.PATIENTS[idx].name}] Rs ${cost}<br>`; toast('Lab suite executed.');
}

/* ‚ïê‚ïê BILLING ‚ïê‚ïê */
function calcBill(p) {
    const days = Math.ceil((new Date()-new Date(p.intakeDate))/86400000)||1;
    const sub = (p.type==='checkup'?0:(days*p.roomPrice))+p.labCost+p.phaCost+p.f;
    const tax = sub*0.18;
    return { s:sub, x:tax, total:Math.max(0,sub+tax-p.deposit) };
}

/* ‚ïê‚ïê FINANCE ‚ïê‚ïê */
function updateFinance() {
    if (S.USER.role!=='admin') return;
    document.getElementById('fin-net').innerText   = 'Rs '+(S.FISCAL.rev-S.FISCAL.pay).toLocaleString();
    document.getElementById('fin-gross').innerText = 'Rs '+S.FISCAL.rev.toLocaleString();
    document.getElementById('fin-pay').innerText   = 'Rs '+S.FISCAL.pay.toLocaleString();
    document.getElementById('fin-tax').innerText   = 'Rs '+(S.FISCAL.rev*0.18).toLocaleString();
}
function wipeFiscal() { if(confirm('VOID FISCAL MATRIX?')){S.FISCAL={rev:0,pay:0};save();updateFinance();} }

/* ‚ïê‚ïê SEARCH & SETTLE ‚ïê‚ïê */
function runSearch() {
    const q = document.getElementById('searchBar').value.toLowerCase(); const m = document.getElementById('searchMount');
    if (!q) { m.innerHTML=''; return; }
    const hits = S.PATIENTS.filter(p=>p.name.toLowerCase().includes(q)&&p.status==='active');
    let h = hits.map(p=>{
        let b = calcBill(p);
        let btn = S.USER.role==='admin' ? `<button class="btn btn-primary" onclick="settle(${p.id})">FINAL SETTLEMENT</button>` : `<div style="font-size:10px;color:var(--ios-red);font-weight:800;">ADMIN_AUTHORIZATION_REQUIRED</div>`;
        return `<div class="glass section-in" style="padding:32px;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;"><div class="glass-shine"></div><div><span class="stat-label">Identity Node</span><h3 style="font-size:20px;font-weight:800;margin-top:4px;">${p.name}</h3></div><div style="text-align:right;"><span class="stat-label">Active Flux Due</span><h3 style="color:var(--ios-blue);font-size:22px;font-weight:800;margin-top:4px;">Rs ${b.total.toLocaleString()}</h3></div>${btn}</div>`;
    }).join('');
    m.innerHTML = h || '<p style="text-align:center;opacity:0.3;font-weight:800;padding:40px;">NODE_NOT_RESOLVED.</p>';
}

function settle(id) {
    if (S.USER.role!=='admin') return;
    const idx = S.PATIENTS.findIndex(p=>p.id==id); const bill = calcBill(S.PATIENTS[idx]);
    const comm = bill.s*0.15; const di = S.ROSTER.findIndex(d=>d.n===S.PATIENTS[idx].doc);
    if (di!==-1) S.ROSTER[di].earnings+=comm;
    S.FISCAL.rev+=bill.total; S.FISCAL.pay+=comm; S.PATIENTS[idx].status='discharged';
    save(); renderInvoice(S.PATIENTS[idx],bill); runSearch(); audit('FIN: Discharge '+S.PATIENTS[idx].name);
}

function renderInvoice(p, b) {
    document.getElementById('invoice-payload').innerText = `NODE: ${p.id}\nIDENTITY: ${p.name.toUpperCase()}\nPHYSICIAN: ${p.doc.toUpperCase()}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nWARD:  Rs ${(b.s-p.labCost-p.phaCost-p.f).toLocaleString()}\nDIAG:  Rs ${p.labCost.toLocaleString()}\nMEDS:  Rs ${p.phaCost.toLocaleString()}\nTAX:   Rs ${b.x.toLocaleString()}\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nSETTLED: Rs ${b.total.toLocaleString()}`;
    document.getElementById('modal-root').style.display='flex';
}
function closeModal() { document.getElementById('modal-root').style.display='none'; }

/* ‚ïê‚ïê DASHBOARD ‚ïê‚ïê */
function updateDashboard() {
    if (S.USER.role!=='admin') return;
    const active = S.PATIENTS.filter(p=>p.status==='active');
    document.getElementById('dash-p-count').innerText = active.length;
    const flux = active.reduce((a,c)=>a+calcBill(c).total, 0);
    document.getElementById('dash-rev').innerText = 'Rs '+flux.toLocaleString();
    document.getElementById('auditContainer').innerHTML = S.AUDIT.slice().reverse().join('<br>');
    initChart();
}

function audit(msg) { S.AUDIT.push('> ['+new Date().toLocaleTimeString()+'] '+msg); if(S.AUDIT.length>80) S.AUDIT.shift(); save(); }

/* ‚ïê‚ïê GALLERY ‚ïê‚ïê */
function renderGallery() {
    document.getElementById('galleryMount').innerHTML = IMAGES.map(i=>`<div class="gallery-node"><img src="${i.url}?auto=format&fit=crop&q=80&w=600" alt="${i.l}" loading="lazy"></div>`).join('');
}

/* ‚ïê‚ïê SAVE ‚ïê‚ïê */
function save() {
    localStorage.setItem('hms_v34_roster',   JSON.stringify(S.ROSTER));
    localStorage.setItem('hms_v34_patients', JSON.stringify(S.PATIENTS));
    localStorage.setItem('hms_v34_audit',    JSON.stringify(S.AUDIT));
    localStorage.setItem('hms_v34_rev', S.FISCAL.rev);
    localStorage.setItem('hms_v34_pay', S.FISCAL.pay);
}

/* ‚ïê‚ïê SNAKE ‚ïê‚ïê */
function initSnake() {
    const canvas=document.getElementById('snakeGame'); const ctx=canvas.getContext('2d');
    let box=25, score=0, dir; let snake=[{x:9*box,y:10*box}];
    let food={x:Math.floor(Math.random()*19)*box,y:Math.floor(Math.random()*19)*box};
    const dark=document.body.classList.contains('dark');
    document.onkeydown=e=>{if(e.keyCode==37&&dir!='RIGHT')dir='LEFT';else if(e.keyCode==38&&dir!='DOWN')dir='UP';else if(e.keyCode==39&&dir!='LEFT')dir='RIGHT';else if(e.keyCode==40&&dir!='UP')dir='DOWN';};
    function draw(){
        ctx.fillStyle=dark?'#1c1c1e':'rgba(242,242,247,0.8)';ctx.fillRect(0,0,500,500);
        snake.forEach((s,i)=>{ctx.fillStyle=i===0?'#007aff':(dark?'#48484a':'#c7c7cc');ctx.beginPath();ctx.roundRect(s.x+1,s.y+1,box-2,box-2,6);ctx.fill();});
        ctx.fillStyle='#ff3b30';ctx.beginPath();ctx.roundRect(food.x+1,food.y+1,box-2,box-2,8);ctx.fill();
        let hX=snake[0].x,hY=snake[0].y;
        if(dir=='LEFT')hX-=box;if(dir=='UP')hY-=box;if(dir=='RIGHT')hX+=box;if(dir=='DOWN')hY+=box;
        if(hX==food.x&&hY==food.y){score++;document.getElementById('snakeScore').innerText=score;food={x:Math.floor(Math.random()*19)*box,y:Math.floor(Math.random()*19)*box};}else snake.pop();
        if(hX<0||hX>=500||hY<0||hY>=500){clearInterval(window.snakeT);toast('Reflex Failure.');}
        snake.unshift({x:hX,y:hY});
    }
    clearInterval(window.snakeT); window.snakeT=setInterval(draw,115);
}

/* ‚ïê‚ïê CHART ‚ïê‚ïê */
function initChart() {
    const ctx=document.getElementById('mainChart').getContext('2d');
    if(window.myChart) window.myChart.destroy();
    const isDark=document.body.classList.contains('dark');
    window.myChart=new Chart(ctx,{type:'line',data:{labels:['00:00','04:00','08:00','12:00','16:00','20:00'],datasets:[{data:[35,60,45,95,75,90],borderColor:'#007aff',fill:true,backgroundColor:isDark?'rgba(0,122,255,0.08)':'rgba(0,122,255,0.05)',tension:0.45,borderWidth:3,pointRadius:0}]},options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}});
}

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
if (localStorage.getItem('hms_v34_theme')==='dark') document.body.classList.add('dark');
</script>
</body>
</html>
